# Asta e ce rulează Piped oficial (pentru referință)
# NU pentru Zerops - doar să înțelegi structura

version: "3"
services:
  # 1. Frontend (UI)
  piped-frontend:
    image: 1337kavin/piped-frontend:latest
    restart: unless-stopped
    depends_on:
      - piped-backend

  # 2. Backend (API)
  piped-backend:
    image: 1337kavin/piped:latest
    restart: unless-stopped
    volumes:
      - ./config.properties:/app/config.properties:ro
    depends_on:
      - postgres

  # 3. Proxy (pentru stream-uri video/audio)
  piped-proxy:
    image: 1337kavin/piped-proxy:latest
    restart: unless-stopped
    environment:
      - UDS=1

  # 4. PostgreSQL Database
  postgres:
    image: postgres:16-alpine
    restart: unless-stopped
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=piped
      - POSTGRES_USER=piped
      - POSTGRES_PASSWORD=changeme

  # 5. Nginx (reverse proxy intern)
  nginx:
    image: nginx:mainline-alpine
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - piped-frontend
      - piped-backend
      - piped-proxy

  # 6. Caddy (HTTPS automatic)
  caddy:
    image: caddy:alpine
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./config/Caddyfile:/etc/caddy/Caddyfile:ro
      - ./data/caddy:/data

